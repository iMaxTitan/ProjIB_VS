# Авторизация в приложении

## Общая логика

1. **Azure токен**:
   - Хранится в MSAL хранилище на клиенте
   - Проверяется при входе на корень и переходе между разделами
   - Обновляется автоматически через MSAL

2. **Куки приложения**:
   - Хранят данные пользователя для UI/логики
   - Проверяются middleware
   - Создаются при успешной авторизации

## Процесс авторизации

### 1. Заход на корень (`/`)
- Проверка Azure токена через MSAL
- Если нет/невалиден -> на login
- Если валиден -> проверка куки
- Если куки нет -> создание через API
- Редирект на dashboard

### 2. Callback от Azure
- MSAL сохраняет токены
- Проверка куки
- Если куки нет -> создание через API
- Редирект на dashboard

### 3. Переход между разделами
- Проверка Azure токена локально
- Проверка куки
- Если что-то не так -> на корень
- Корень проверит и отправит на login

### 4. Работа с Azure API
- MSAL сам обновляет токен если нужно
- Если не смог обновить -> ошибка
- Обработка ошибки -> на корень -> на login

### 5. Middleware
- Проверяет только куки
- Если куки нет -> на login
- Не проверяет Azure токен

### 6. Выход из системы
- Очистка куки
- MSAL очищает токены
- На login

## Файловая структура

- `src/lib/auth/azure.ts` - работа с Azure MSAL
- `src/lib/auth/session.ts` - работа с сессией (куки)
- `src/lib/auth/middleware.ts` - middleware для проверки авторизации
- `src/lib/auth/hooks.ts` - React хуки для проверки авторизации
- `src/lib/auth/types.ts` - типы для авторизации 