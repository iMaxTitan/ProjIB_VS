# Система Заходів (KPI Measures)

Цей документ описує систему заходів (Measures), яка прийшла на зміну системі послуг для покращення контролю за виконанням KPI в межах процесів СУІБ.

## Огляд архітектури

Система базується на зв'язку:
**Компанія -> Відділ -> Процес -> Квартальний план -> Місячний план -> Захід (KPI)**

### База даних
Таблиця `measures` містить цільові показники для кожного процесу:
- `measure_id`: Унікальний ідентифікатор.
- `process_id`: Зв'язок з процесом СУІБ.
- `name`: Назва заходу (наприклад, "Проведення внутрішніх аудитів").
- `category`: Тип заходу (`strategic`, `process`, `operational`).
- `target_value`: Цільова кількість виконань за період.
- `target_period`: Період планування (наразі `quarter`).

### Інтеграція з плануванням
Місячні плани тепер посилаються на `measure_id` замість `service_id`. Це дозволяє:
1. Відстежувати виконання конкретних KPI через щоденні завдання.
2. Автоматично розраховувати відсоток виконання заходів на основі списаних годин.
3. Фільтрувати доступні заходи в картці планування залежно від процесу, що закріплений за квартальним планом.

## Ключові зміни в коді

### Types (`src/types/planning.ts`)
Додано інтерфейс `Measure` та оновлено `MonthlyPlan`:
```typescript
export interface Measure {
  measure_id: string;
  process_id: string | null;
  name: string;
  category: MeasureCategory;
  target_value: number;
  target_period: 'year' | 'quarter' | 'month';
  // ...
}
```

### Services (`src/lib/plans/plan-service.ts`)
Додано функцію `getMeasures(processId)` для отримання списку доступних заходів. Функції `getMonthlyPlans` та `manageMonthlyPlan` оновлені для роботи з новими полями.

### UI (`src/components/plans/details/MonthlyPlanDetails.tsx`)
1. Замінено селектор "Послуги" на "Заходи (KPI)".
2. Додано автоматичне скидання обраного заходу при зміні квартального плану.
3. Оновлено відображення назви заходу в режимі перегляду.

## Подальші кроки
- [ ] Реалізація дашборду KPI на основі накопичених даних за заходами.
- [ ] Перенесення решти логіки зі старих "Послуг" на нові "Заходи".
