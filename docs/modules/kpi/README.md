# Модуль "KPI"

## Общее описание

Модуль "KPI" (Ключевые показатели эффективности) предназначен для отображения и анализа ключевых показателей эффективности процессов и отделов в системе ReportIB. Он позволяет визуализировать данные о производительности в виде графиков и карточек с метриками, а также отслеживать динамику изменений показателей во времени.

## Архитектура модуля

Модуль построен на основе архитектуры Next.js + Supabase + M365 и следует принципам компонентного подхода. Компоненты организованы в соответствии с их функциональным назначением.

### Структура файлов

```markdown
src/
│── app/
│   └── dashboard/
│       └── kpi/
│           └── page.tsx                  # Страница KPI (точка входа)
│── components/
│   │── dashboard/
│   │   │── content/
│   │   │   └── KPIContent.tsx            # Основной контент раздела KPI
│   │   └── kpi/
│   │       │── KPICard.tsx               # Карточка с показателем KPI
│   │       │── KPISummaryCards.tsx       # Блок с общими показателями KPI
│   │       │── KPIFilters.tsx            # Фильтры и вкладки для KPI
│   │       │── ProcessKPISection.tsx     # Секция с KPI по процессам
│   │       │── DepartmentKPISection.tsx  # Секция с KPI по отделам
│   │       │── ProcessKPIChart.tsx       # График KPI по процессам
│   │       │── DepartmentKPIChart.tsx    # График KPI по отделам
│   │       └── utils/
│   │           └── kpiUtils.ts           # Утилиты для работы с KPI
└── types/
    └── kpi.ts                           # Типы и интерфейсы для KPI
```

## Ключевые компоненты

### 1. Страница KPI (`app/dashboard/kpi/page.tsx`)

Точка входа в модуль KPI. Отвечает за инициализацию и отображение основного контента раздела.

### 2. Основной контент (`components/dashboard/content/KPIContent.tsx`)

Центральный компонент, который:

- Загружает данные KPI из Supabase
- Обрабатывает фильтрацию по периодам
- Управляет переключением между представлениями (процессы/отделы)
- Отображает сводные показатели и детальную информацию

### 3. Карточка KPI (`components/dashboard/kpi/KPICard.tsx`)

- Отображает информацию о конкретном показателе KPI
- Показывает текущее значение, целевое значение и изменение
- Визуализирует прогресс с помощью цветовой индикации

### 4. Секции KPI

#### 4.1. Секция KPI по процессам (`components/dashboard/kpi/ProcessKPISection.tsx`)
- Отображает график и детальную информацию о KPI по процессам
- Визуализирует прогресс достижения целевых показателей
- Показывает динамику изменений

#### 4.2. Секция KPI по отделам (`components/dashboard/kpi/DepartmentKPISection.tsx`)
- Отображает график и детальную информацию о KPI по отделам
- Визуализирует прогресс достижения целевых показателей
- Показывает динамику изменений

### 5. Утилиты для работы с KPI (`components/dashboard/kpi/utils/kpiUtils.ts`)

- Функции для расчета средних значений KPI
- Функции для трансформации данных из Supabase
- Генерация периодов для фильтрации
- Функции для расчета KPI по категориям

## Процессы и сценарии использования

1. **Просмотр общих показателей KPI**:
   - Пользователь открывает раздел KPI в дашборде
   - Система отображает карточки с общими показателями эффективности
   - Пользователь видит текущие значения, целевые показатели и динамику изменений

2. **Анализ KPI по процессам**:
   - Пользователь выбирает вкладку "Процессы"
   - Система отображает график и детальную информацию о KPI по процессам
   - Пользователь может анализировать эффективность различных процессов

3. **Анализ KPI по отделам**:
   - Пользователь выбирает вкладку "Отделы"
   - Система отображает график и детальную информацию о KPI по отделам
   - Пользователь может сравнивать эффективность различных отделов

4. **Фильтрация по периодам**:
   - Пользователь выбирает период из выпадающего списка
   - Система обновляет данные в соответствии с выбранным периодом
   - Пользователь может анализировать динамику показателей в разные периоды

## Интеграция с другими модулями

1. **Модуль "Сотрудники"**:
   - KPI отделов связаны с сотрудниками этих отделов
   - Показатели эффективности сотрудников влияют на KPI отделов

2. **Модуль "Планы"**:
   - KPI связаны с выполнением планов и задач
   - Достижение целевых показателей планов отражается в KPI

3. **Модуль "Отчеты"**:
   - Данные KPI используются для формирования отчетов
   - Аналитика по KPI включается в общие отчеты по эффективности

## Права доступа

Доступ к функциям модуля "KPI" определяется ролью пользователя:

1. **Просмотр KPI**:
   - Доступно для всех авторизованных пользователей
   - Сотрудники видят только KPI своего отдела и общие показатели
   - Руководители отделов видят KPI своего отдела и подчиненных отделов
   - Руководители организации видят все KPI

2. **Настройка целевых показателей**:
   - Доступно для ролей `admin`, `chief` и `head`
   - Руководители отделов могут настраивать KPI только для своего отдела

## Особенности реализации

1. **Визуализация данных**:
   - Использование графиков и диаграмм для наглядного представления KPI
   - Цветовая индикация прогресса (зеленый - достигнуто, желтый - близко, красный - отставание)
   - Индикаторы динамики изменений (стрелки вверх/вниз)

2. **Работа с данными**:
   - Загрузка данных из Supabase с использованием представлений
   - Кэширование данных для оптимизации производительности
   - Трансформация данных для удобного отображения

3. **Адаптивный дизайн**:
   - Корректное отображение на различных устройствах
   - Оптимизация для мобильных устройств
   - Доступность (a11y) для всех пользователей

## Рекомендации по доработке

1. **Расширение функциональности**:
   - Добавление KPI по сотрудникам
   - Реализация настройки целевых показателей через интерфейс
   - Добавление прогнозной аналитики на основе исторических данных

2. **Улучшение визуализации**:
   - Добавление интерактивных графиков с возможностью детализации
   - Реализация сравнительного анализа показателей за разные периоды
   - Добавление тепловых карт для визуализации KPI по отделам

3. **Интеграции**:
   - Экспорт данных в Excel/PDF
   - Интеграция с системами бизнес-аналитики
   - Автоматическая отправка отчетов по KPI по расписанию

4. **Аналитика**:
   - Добавление более детальной аналитики с разбивкой по периодам
   - Внедрение системы оповещений при критических отклонениях от целевых показателей
   - Разработка дашборда с ключевыми трендами и прогнозами
