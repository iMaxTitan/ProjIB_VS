# Модуль "Активность"

## Общее описание

Модуль "Активность" предназначен для отображения текущей активности пользователей в системе ReportIB. Он предоставляет обзор последних действий, уведомлений и ключевых показателей эффективности (KPI) в виде информативного дашборда. Модуль служит главной точкой входа в систему и дает пользователю быстрый доступ к наиболее важной информации.

## Архитектура модуля

Модуль построен на основе архитектуры Next.js + Supabase + M365 и следует принципам компонентного подхода. Компоненты организованы в соответствии с их функциональным назначением.

### Структура файлов

```markdown
src/
│── app/
│   └── dashboard/
│       └── page.tsx                      # Главная страница дашборда (активность)
│── components/
│   │── dashboard/
│   │   │── ActivityCard.tsx              # Карточка активности
│   │   │── NotificationCard.tsx          # Карточка уведомления
│   │   │── KPICard.tsx                   # Карточка с ключевыми показателями
│   │   └── content/
│   │       └── ActivityContent.tsx       # Основной контент раздела активности
│── hooks/
│   └── useActivity.ts                    # Хук для работы с данными активности
│── lib/
│   └── activity/
│       └── activity-service.ts           # Сервис для работы с API активности
└── types/
    └── activity.ts                       # Типы и интерфейсы для активности
```

## Ключевые компоненты

### 1. Главная страница дашборда (`app/dashboard/page.tsx`)

Точка входа в модуль активности. Отвечает за инициализацию и отображение основного контента дашборда.

### 2. Основной контент (`components/dashboard/content/ActivityContent.tsx`)

Центральный компонент, который:

- Отображает обзор активности пользователя
- Показывает уведомления и последние события
- Предоставляет ключевые показатели эффективности (KPI)

### 3. Карточки активности

#### 3.1. Карточка активности (`components/dashboard/ActivityCard.tsx`)

- Отображает информацию о конкретном действии или событии
- Показывает тип активности, время и связанные объекты
- Предоставляет быстрые действия для реагирования на событие

#### 3.2. Карточка уведомления (`components/dashboard/NotificationCard.tsx`)

- Отображает уведомления для пользователя
- Поддерживает различные типы уведомлений (информация, предупреждение, ошибка)
- Предоставляет возможность отметить уведомление как прочитанное

#### 3.3. Карточка KPI (`components/dashboard/KPICard.tsx`)

- Отображает ключевые показатели эффективности
- Визуализирует данные с помощью графиков и диаграмм
- Показывает тренды и сравнения с предыдущими периодами

### 4. Хук для работы с активностью (`hooks/useActivity.ts`)

- Загружает данные активности из Supabase
- Обрабатывает уведомления и события
- Управляет состоянием загрузки и ошибками

## Потоки данных

1. **Загрузка данных**:
   - При входе на главную страницу дашборда загружаются данные активности
   - Данные включают последние действия пользователя, уведомления и KPI
   - Информация обновляется в реальном времени через Supabase Realtime

2. **Обработка уведомлений**:
   - Новые уведомления поступают через Supabase Realtime
   - Пользователь может отметить уведомления как прочитанные
   - Статус уведомлений сохраняется в базе данных

3. **Отображение KPI**:
   - Ключевые показатели рассчитываются на основе данных из различных модулей
   - Данные визуализируются с помощью графиков и диаграмм
   - Показатели обновляются при изменении данных

## Взаимодействие с другими модулями

1. **Модуль "Планы"**:
   - Отображает активность, связанную с созданием и изменением планов
   - Показывает KPI по выполнению планов
   - Предоставляет быстрый доступ к активным планам

2. **Модуль "Задачи"**:
   - Отображает активность, связанную с задачами
   - Показывает уведомления о приближающихся сроках
   - Предоставляет информацию о прогрессе выполнения задач

3. **Модуль "Отчеты"**:
   - Отображает активность, связанную с созданием и просмотром отчетов
   - Показывает ключевые метрики из отчетов
   - Предоставляет быстрый доступ к последним отчетам

## Права доступа

Доступ к функциям модуля "Активность" определяется ролью пользователя:

1. **Просмотр активности**: 
   - Доступно для всех авторизованных пользователей
   - Пользователи видят только активность, связанную с их действиями и объектами, к которым у них есть доступ

2. **Просмотр KPI**:
   - Руководители (`chief`, `head`) видят KPI по своим подразделениям
   - Сотрудники видят только свои личные KPI

3. **Управление уведомлениями**:
   - Все пользователи могут управлять своими уведомлениями
   - Администраторы могут настраивать глобальные уведомления

## Особенности реализации

1. **Realtime обновления**:
   - Использование Supabase Realtime для обновления данных в реальном времени
   - Мгновенное отображение новых уведомлений и событий
   - Автоматическое обновление KPI при изменении данных

2. **Персонализация**:
   - Настраиваемый дашборд с возможностью выбора отображаемых виджетов
   - Фильтрация активности по типам и источникам
   - Настройка уведомлений по предпочтениям пользователя

3. **Визуализация данных**:
   - Использование современных библиотек для визуализации данных
   - Интерактивные графики и диаграммы
   - Адаптивный дизайн для различных устройств

## Рекомендации по доработке

1. **Расширение функциональности**:
   - Добавление прогнозной аналитики на основе исторических данных
   - Внедрение персональных рекомендаций на основе активности
   - Разработка системы целей и отслеживания их достижения

2. **Улучшение UX**:
   - Добавление возможности настройки дашборда через drag-and-drop
   - Разработка мобильной версии с push-уведомлениями
   - Улучшение доступности для пользователей с ограниченными возможностями

3. **Интеграции**:
   - Интеграция с календарем Microsoft 365 для отображения событий
   - Добавление виджетов для внешних сервисов и API
   - Экспорт данных активности в различные форматы

4. **Аналитика**:
   - Расширение системы KPI с более глубоким анализом
   - Добавление сравнительного анализа между отделами и сотрудниками
   - Внедрение предиктивной аналитики для прогнозирования трендов
