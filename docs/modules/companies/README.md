# Модуль "Компании"

## Общее описание

Модуль "Компании" предназначен для управления информацией о компаниях-партнерах в системе ReportIB. Он позволяет создавать, просматривать, редактировать и управлять данными о компаниях, включая контактную информацию, договоры, проекты и связи с другими модулями системы.

## Архитектура модуля

Модуль построен на основе архитектуры Next.js + Supabase + M365 и следует принципам компонентного подхода. Компоненты организованы в соответствии с их функциональным назначением.

### Структура файлов

```markdown
src/
│── app/
│   └── dashboard/
│       └── companies/
│           └── page.tsx                  # Страница компаний (точка входа)
│── components/
│   │── dashboard/
│   │   │── CompanyCard.tsx               # Карточка компании
│   │   │── content/
│   │   │   └── CompaniesContent.tsx      # Основной контент раздела компаний
│   │   └── companies/
│   │       │── CompanyFormModal.tsx      # Модальное окно для создания/редактирования компании
│   │       └── CompanyDetailsModal.tsx   # Модальное окно с детальной информацией о компании
│── hooks/
│   └── useCompanies.ts                   # Хук для работы с данными компаний
│── lib/
│   └── companies/
│       └── company-service.ts            # Сервис для работы с API компаний
└── types/
    └── company.ts                        # Типы и интерфейсы для компаний
```

## Ключевые компоненты

### 1. Страница компаний (`app/dashboard/companies/page.tsx`)

Точка входа в модуль компаний. Отвечает за инициализацию и отображение основного контента раздела.

### 2. Основной контент (`components/dashboard/content/CompaniesContent.tsx`)

Центральный компонент, который:

- Отображает список компаний-партнеров
- Предоставляет возможности фильтрации и поиска
- Обрабатывает действия по управлению компаниями (добавление, редактирование, удаление)

### 3. Карточка компании (`components/dashboard/CompanyCard.tsx`)

- Отображает информацию о компании в компактном виде
- Показывает ключевую информацию: название, логотип, контакты, статус
- Предоставляет быстрый доступ к основным действиям (просмотр деталей, редактирование)

### 4. Модальные окна для работы с компаниями

#### 4.1. Форма компании (`components/dashboard/companies/CompanyFormModal.tsx`)
- Форма для создания и редактирования информации о компании
- Валидация данных и отправка на сервер
- Поддержка загрузки логотипов и документов

#### 4.2. Детали компании (`components/dashboard/companies/CompanyDetailsModal.tsx`)
- Отображает подробную информацию о компании
- Показывает связанные проекты, контакты и договоры
- Предоставляет доступ к истории взаимодействия

### 5. Хук для работы с компаниями (`hooks/useCompanies.ts`)

- Загружает данные компаний из Supabase
- Обрабатывает CRUD-операции для компаний
- Управляет состоянием загрузки и ошибками

## Потоки данных

1. **Загрузка данных**:
   - При входе на страницу компаний загружается список всех компаний-партнеров
   - Данные могут фильтроваться по различным параметрам (статус, тип, отрасль)
   - Поддерживается поиск по названию и другим атрибутам

2. **Создание и редактирование компаний**:
   - Кнопка "Добавить компанию" открывает модальное окно с формой
   - После заполнения формы данные отправляются в Supabase
   - После успешного создания/редактирования список компаний обновляется

3. **Просмотр деталей компании**:
   - При клике на карточку компании открывается модальное окно с подробной информацией
   - Информация включает контакты, проекты, договоры и историю взаимодействия
   - Предоставляется возможность экспорта данных в различные форматы

## Взаимодействие с другими модулями

1. **Модуль "Планы"**:
   - Компании могут быть связаны с годовыми и квартальными планами
   - Планы могут быть отфильтрованы по компаниям
   - Статистика по планам доступна в деталях компании

2. **Модуль "Сотрудники"**:
   - Сотрудники могут быть назначены ответственными за компании
   - Контактные лица компаний связаны с сотрудниками
   - История взаимодействия сотрудников с компаниями

3. **Модуль "Отчеты"**:
   - Формирование отчетов по компаниям и их проектам
   - Аналитика по эффективности сотрудничества
   - Экспорт данных для внешних систем

## Права доступа

Доступ к функциям модуля "Компании" определяется ролью пользователя:

1. **Просмотр списка компаний**: 
   - Доступно для всех авторизованных пользователей
   - Ограничения могут применяться в зависимости от отдела и роли

2. **Создание и редактирование компаний**:
   - Доступно для ролей `admin`, `chief` и `head`
   - Менеджеры (`manager`) могут редактировать только компании, за которые они ответственны

3. **Удаление компаний**:
   - Доступно только для ролей `admin` и `chief`
   - Требует подтверждения и проверки отсутствия связанных данных

## Особенности реализации

1. **Управление документами**:
   - Хранение и версионирование договоров и других документов
   - Интеграция с Supabase Storage для файлов
   - Поддержка различных форматов документов

2. **Интеграция с CRM**:
   - Возможность импорта/экспорта данных из внешних CRM-систем
   - Синхронизация контактов и истории взаимодействия
   - API для обмена данными с другими системами

3. **Аналитика и отчетность**:
   - Статистика по взаимодействию с компаниями
   - Отслеживание эффективности сотрудничества
   - Прогнозирование развития партнерских отношений

## Рекомендации по доработке

1. **Расширение функциональности**:
   - Добавление модуля управления договорами с автоматическим отслеживанием сроков
   - Внедрение системы оценки и рейтингования компаний-партнеров
   - Разработка функционала для управления проектами с компаниями

2. **Улучшение UX**:
   - Добавление интерактивной карты с расположением компаний
   - Разработка таймлайна взаимодействия с компанией
   - Улучшение визуализации связей между компаниями и проектами

3. **Интеграции**:
   - Интеграция с популярными CRM-системами (Salesforce, HubSpot)
   - Добавление возможности импорта данных из Excel/CSV
   - Интеграция с сервисами проверки контрагентов

4. **Аналитика**:
   - Расширение аналитических возможностей с прогнозной аналитикой
   - Добавление дашборда с ключевыми показателями по компаниям
   - Внедрение системы уведомлений о важных событиях (истечение срока договора, день рождения компании)
